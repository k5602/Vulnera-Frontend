---
// Enhanced interactive sidebar with animations and effects
---

<aside 
  id="sidebar" 
  class="fixed left-0 top-0 h-screen bg-black/95 backdrop-blur-md terminal-border border-l-0 border-t-0 border-b-0 z-30 transition-all duration-300 ease-in-out overflow-hidden"
  aria-label="Main sidebar navigation"
>
  <!-- Animated Background Gradient -->
  <div class="absolute inset-0 opacity-20 pointer-events-none">
    <div class="absolute top-0 left-0 w-full h-1/3 bg-gradient-to-b from-cyber-400/20 to-transparent animate-pulse"></div>
    <div class="absolute bottom-0 left-0 w-full h-1/3 bg-gradient-to-t from-matrix-400/20 to-transparent animate-pulse" style="animation-delay: 1s;"></div>
  </div>

  <!-- Toggle Button with Animation -->
  <button 
    id="sidebar-toggle"
    class="absolute -right-3 top-6 w-8 h-8 rounded-full bg-gradient-to-r from-cyber-600 to-matrix-600 terminal-border flex items-center justify-center hover:scale-125 hover:rotate-180 transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyber-400 shadow-lg hover:shadow-cyber-400/50 group z-10"
    aria-label="Toggle sidebar"
    aria-expanded="false"
  >
    <svg class="w-4 h-4 text-black transition-transform duration-300 group-hover:scale-110" id="toggle-icon" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </button>

  <!-- Logo Section with Animation -->
  <div class="p-4 mb-2 relative">
    <div class="flex items-center justify-center h-16 relative overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-r from-cyber-400/10 via-matrix-400/10 to-cyber-400/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
      <span class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyber-400 to-matrix-400 relative z-10 animate-pulse">V</span>
      <span class="sidebar-text ml-2 text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyber-400 to-matrix-400 opacity-0 pointer-events-none transition-opacity duration-300">ULNERA</span>
    </div>
  </div>
  

  <!-- Navigation Links -->
  <nav class="flex flex-col gap-2 p-4 relative z-10" aria-label="Sidebar navigation">
    <!-- Home -->
    <a 
      href="/" 
      class="sidebar-link group relative flex items-center h-12 rounded-lg hover:bg-gradient-to-r hover:from-cyber-400/20 hover:to-transparent transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyber-400 overflow-hidden"
      data-label="Home"
      id="home-page"
    >
      <!-- Ripple Effect Container -->
      <span class="ripple-container absolute inset-0 overflow-hidden"></span>
      
      <!-- Active Indicator -->
      <span class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-0 bg-gradient-to-b from-cyber-400 to-matrix-400 rounded-r-full transition-all duration-300 group-hover:h-8"></span>
      
      <div class="flex items-center justify-center w-12 h-12 relative z-10">
        <svg class="w-6 h-6 text-cyber-400 group-hover:text-cyber-300 group-hover:scale-110 transition-all duration-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-cyber-300 whitespace-nowrap opacity-0 pointer-events-none transition-all duration-300 font-mono font-bold tracking-wider relative z-10">HOME</span>
      
      <!-- Enhanced Tooltip -->
      <div class="sidebar-tooltip absolute left-full ml-3 px-4 py-2 bg-gradient-to-r from-black/95 to-cyber-900/50 terminal-border rounded-lg text-cyber-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-all duration-200 z-50 shadow-lg">
        <span class="font-mono">Home</span>
        <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 w-2 h-2 bg-cyber-400 rounded-full animate-ping"></div>
      </div>
    </a>

    <!-- Scan -->
    <a 
      href="/scan" 
      class="sidebar-link auth-only group relative flex items-center h-12 rounded-lg hover:bg-gradient-to-r hover:from-cyber-400/20 hover:to-transparent transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyber-400 overflow-hidden"
      data-label="Scan"
      style="display: none"
    >
      <!-- Ripple Effect Container -->
      <span class="ripple-container absolute inset-0 overflow-hidden"></span>
      
      <!-- Active Indicator -->
      <span class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-0 bg-gradient-to-b from-cyber-400 to-matrix-400 rounded-r-full transition-all duration-300 group-hover:h-8"></span>
      
      <div class="flex items-center justify-center w-12 h-12 relative z-10">
        <svg class="w-6 h-6 text-cyber-400 group-hover:text-cyber-300 group-hover:scale-110 group-hover:rotate-12 transition-all duration-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <!-- Pulse indicator -->
        <span class="absolute top-2 right-2 w-2 h-2 bg-matrix-400 rounded-full animate-pulse"></span>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-cyber-300 whitespace-nowrap opacity-0 pointer-events-none transition-all duration-300 font-mono font-bold tracking-wider relative z-10">SCAN</span>
      
      <!-- Enhanced Tooltip -->
      <div class="sidebar-tooltip absolute left-full ml-3 px-4 py-2 bg-gradient-to-r from-black/95 to-cyber-900/50 terminal-border rounded-lg text-cyber-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-all duration-200 z-50 shadow-lg">
        <span class="font-mono">Scan Project</span>
        <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 w-2 h-2 bg-cyber-400 rounded-full animate-ping"></div>
      </div>
    </a>

    <!-- Dashboard -->
    <a 
      href="/dashboard" 
      class="sidebar-link auth-only group relative flex items-center h-12 rounded-lg hover:bg-gradient-to-r hover:from-matrix-400/20 hover:to-transparent transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyber-400 overflow-hidden"
      data-label="Dashboard"
      style="display: none"
    >
      <!-- Ripple Effect Container -->
      <span class="ripple-container absolute inset-0 overflow-hidden"></span>
      
      <!-- Active Indicator -->
      <span class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-0 bg-gradient-to-b from-matrix-400 to-cyber-400 rounded-r-full transition-all duration-300 group-hover:h-8"></span>
      
      <div class="flex items-center justify-center w-12 h-12 relative z-10">
        <svg class="w-6 h-6 text-matrix-400 group-hover:text-matrix-300 group-hover:scale-110 transition-all duration-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-matrix-200 whitespace-nowrap opacity-0 pointer-events-none transition-all duration-300 font-mono font-bold tracking-wider relative z-10">DASHBOARD</span>
      
      <!-- Enhanced Tooltip -->
      <div class="sidebar-tooltip absolute left-full ml-3 px-4 py-2 bg-gradient-to-r from-black/95 to-matrix-900/50 terminal-border rounded-lg text-matrix-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-all duration-200 z-50 shadow-lg">
        <span class="font-mono">Dashboard</span>
        <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 w-2 h-2 bg-matrix-400 rounded-full animate-ping"></div>
      </div>
    </a>

    <!-- About -->
    <a 
      href="/about" 
      class="sidebar-link group relative flex items-center h-12 rounded-lg hover:bg-gradient-to-r hover:from-cyan-400/20 hover:to-transparent transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400 overflow-hidden"
      data-label="About"
    >
      <!-- Ripple Effect Container -->
      <span class="ripple-container absolute inset-0 overflow-hidden"></span>
      
      <!-- Active Indicator -->
      <span class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-0 bg-gradient-to-b from-cyan-400 to-blue-400 rounded-r-full transition-all duration-300 group-hover:h-8"></span>
      
      <div class="flex items-center justify-center w-12 h-12 relative z-10">
        <svg class="w-6 h-6 text-cyan-400 group-hover:text-cyan-300 group-hover:scale-110 group-hover:rotate-12 transition-all duration-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-cyan-300 whitespace-nowrap opacity-0 pointer-events-none transition-all duration-300 font-mono font-bold tracking-wider relative z-10">ABOUT</span>
      
      <!-- Enhanced Tooltip -->
      <div class="sidebar-tooltip absolute left-full ml-3 px-4 py-2 bg-gradient-to-r from-black/95 to-cyan-900/50 terminal-border rounded-lg text-cyan-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-all duration-200 z-50 shadow-lg">
        <span class="font-mono">About</span>
        <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 w-2 h-2 bg-cyan-400 rounded-full animate-ping"></div>
      </div>
    </a>

    <!-- Animated Divider -->
    <div class="my-2 relative overflow-hidden">
      <div class="border-t border-cyber-400/20"></div>
      <div class="absolute inset-0 bg-gradient-to-r from-transparent via-cyber-400/30 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"></div>
    </div>

    <!-- Settings (auth only) -->
    <a 
      href="/settings" 
      class="sidebar-link auth-only group relative flex items-center h-12 rounded-lg hover:bg-gradient-to-r hover:from-purple-400/20 hover:to-transparent transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 overflow-hidden"
      data-label="Settings"
      style="display: none"
    >
      <!-- Ripple Effect Container -->
      <span class="ripple-container absolute inset-0 overflow-hidden"></span>
      
      <!-- Active Indicator -->
      <span class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-0 bg-gradient-to-b from-purple-400 to-pink-400 rounded-r-full transition-all duration-300 group-hover:h-8"></span>
      
      <div class="flex items-center justify-center w-12 h-12 relative z-10">
        <svg class="w-6 h-6 text-purple-400 group-hover:text-purple-300 group-hover:scale-110 group-hover:rotate-90 transition-all duration-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-purple-300 whitespace-nowrap opacity-0 pointer-events-none transition-all duration-300 font-mono font-bold tracking-wider relative z-10">SETTINGS</span>
      
      <!-- Enhanced Tooltip -->
      <div class="sidebar-tooltip absolute left-full ml-3 px-4 py-2 bg-gradient-to-r from-black/95 to-purple-900/50 terminal-border rounded-lg text-purple-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-all duration-200 z-50 shadow-lg">
        <span class="font-mono">Settings</span>
        <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 w-2 h-2 bg-purple-400 rounded-full animate-ping"></div>
      </div>
    </a>

    <!-- Login (guest only) -->
    <a 
      href="/login" 
      class="sidebar-link guest-only group relative flex items-center h-12 rounded-lg hover:bg-gradient-to-r hover:from-green-400/20 hover:to-transparent transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-green-400 overflow-hidden"
      data-label="Login"
    >
      <!-- Ripple Effect Container -->
      <span class="ripple-container absolute inset-0 overflow-hidden"></span>
      
      <!-- Active Indicator -->
      <span class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-0 bg-gradient-to-b from-green-400 to-emerald-400 rounded-r-full transition-all duration-300 group-hover:h-8"></span>
      
      <div class="flex items-center justify-center w-12 h-12 relative z-10">
        <svg class="w-6 h-6 text-green-400 group-hover:text-green-300 group-hover:scale-110 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-green-300 whitespace-nowrap opacity-0 pointer-events-none transition-all duration-300 font-mono font-bold tracking-wider relative z-10">LOGIN</span>
      
      <!-- Enhanced Tooltip -->
      <div class="sidebar-tooltip absolute left-full ml-3 px-4 py-2 bg-gradient-to-r from-black/95 to-green-900/50 terminal-border rounded-lg text-green-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-all duration-200 z-50 shadow-lg">
        <span class="font-mono">Login</span>
        <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 w-2 h-2 bg-green-400 rounded-full animate-ping"></div>
      </div>
    </a>

    <!-- Logout (auth only) -->
    <button 
      id="sidebar-logout-btn"
      class="sidebar-link auth-only group relative flex items-center h-12 rounded-lg hover:bg-gradient-to-r hover:from-red-500/30 hover:to-transparent transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-red-400 w-full overflow-hidden"
      data-label="Logout"
      style="display: none"
    >
      <!-- Ripple Effect Container -->
      <span class="ripple-container absolute inset-0 overflow-hidden"></span>
      
      <!-- Active Indicator -->
      <span class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-0 bg-gradient-to-b from-red-500 to-red-700 rounded-r-full transition-all duration-300 group-hover:h-8"></span>
      
      <div class="flex items-center justify-center w-12 h-12 relative z-10">
        <svg class="w-6 h-6 text-red-400 group-hover:text-red-300 group-hover:scale-110 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-red-300 group-hover:text-red-200 whitespace-nowrap opacity-0 pointer-events-none transition-all duration-300 font-mono font-bold tracking-wider relative z-10">LOGOUT</span>
      
      <!-- Enhanced Tooltip -->
      <div class="sidebar-tooltip absolute left-full ml-3 px-4 py-2 bg-gradient-to-r from-black/95 to-red-900/50 terminal-border rounded-lg text-red-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-all duration-200 z-50 shadow-lg">
        <span class="font-mono">Logout</span>
        <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1/2 w-2 h-2 bg-red-400 rounded-full animate-ping"></div>
      </div>
    </button>
  </nav>
</aside>

<style>
  /* Sidebar default (collapsed) state */
  #sidebar {
    width: 80px;
  }

  /* Sidebar expanded state */
  #sidebar.expanded {
    width: 200px;
  }

  #sidebar.expanded .sidebar-text {
    opacity: 1;
    pointer-events: auto;
    transform: translateX(0);
  }

  #sidebar.expanded #toggle-icon {
    transform: rotate(180deg);
  }

  /* Tooltips only show when collapsed */
  #sidebar:not(.expanded) .sidebar-link:hover .sidebar-tooltip {
    opacity: 1;
    pointer-events: auto;
    transform: translateX(0);
  }

  /* Hide tooltips when expanded */
  #sidebar.expanded .sidebar-tooltip {
    display: none;
  }

  /* Active link indicator - Enhanced */
  .sidebar-link[aria-current="page"] {
    background: linear-gradient(90deg, rgba(26, 255, 239, 0.2), transparent);
    border-left: 4px solid #1affef;
    box-shadow: 0 0 20px rgba(26, 255, 239, 0.3);
  }

  .sidebar-link[aria-current="page"] .absolute.left-0 {
    height: 2rem !important;
  }

  /* Ripple effect animation */
  @keyframes ripple {
    0% {
      transform: scale(0);
      opacity: 0.5;
    }
    100% {
      transform: scale(4);
      opacity: 0;
    }
  }

  .ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(26, 255, 239, 0.5);
    pointer-events: none;
    animation: ripple 0.6s ease-out;
  }

  /* Smooth transitions for text */
  .sidebar-text {
    transform: translateX(-10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Tooltip smooth entrance */
  .sidebar-tooltip {
    transform: translateX(-10px);
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Glowing effect on hover */
  .sidebar-link:hover {
    box-shadow: inset 0 0 20px rgba(26, 255, 239, 0.1);
  }

  /* Icon animations */
  .sidebar-link svg {
    filter: drop-shadow(0 0 0px rgba(26, 255, 239, 0));
    transition: filter 0.3s ease-in-out;
  }

  .sidebar-link:hover svg {
    filter: drop-shadow(0 0 8px rgba(26, 255, 239, 0.6));
  }

  /* Scrollbar styling */
  #sidebar nav::-webkit-scrollbar {
    width: 4px;
  }

  #sidebar nav::-webkit-scrollbar-track {
    background: rgba(26, 255, 239, 0.05);
  }

  #sidebar nav::-webkit-scrollbar-thumb {
    background: rgba(26, 255, 239, 0.3);
    border-radius: 2px;
  }

  #sidebar nav::-webkit-scrollbar-thumb:hover {
    background: rgba(26, 255, 239, 0.5);
  }

  /* Hide sidebar below 1400px - show as mobile menu instead */
  @media (max-width: 1535px) {
    #sidebar {
      transform: translateX(-100%);
      width: 140px !important;
    }

    #sidebar.mobile-open {
      transform: translateX(0);
    }

    #sidebar.mobile-open .sidebar-text {
      opacity: 1;
      pointer-events: auto;
    }

    #sidebar-toggle {
      display: none;
    }
  }

  /* Show sidebar on large screens (1400px and above) */
  @media (min-width: 1536px) {
    #sidebar {
      transform: translateX(0) !important;
    }

    :global(main), :global(section), :global(.relative) {
      transition: padding-left 0.3s ease-in-out;
    }
  }
</style>

<script>
  // Sidebar toggle functionality
  const sidebar = document.getElementById('sidebar');
  const toggleBtn = document.getElementById('sidebar-toggle');
  const sidebarLinks = document.querySelectorAll('.sidebar-link');

  // Ripple effect function
  function createRipple(event: MouseEvent, element: HTMLElement) {
    const rippleContainer = element.querySelector('.ripple-container');
    if (!rippleContainer) return;

    const ripple = document.createElement('span');
    const rect = rippleContainer.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    const x = event.clientX - rect.left - size / 2;
    const y = event.clientY - rect.top - size / 2;

    ripple.style.width = ripple.style.height = `${size}px`;
    ripple.style.left = `${x}px`;
    ripple.style.top = `${y}px`;
    ripple.classList.add('ripple');

    rippleContainer.appendChild(ripple);

    setTimeout(() => ripple.remove(), 600);
  }

  // Add ripple effect to all sidebar links
  sidebarLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      createRipple(e as MouseEvent, link as HTMLElement);
    });
  });

  // Check if sidebar should be expanded from localStorage
  const isExpanded = localStorage.getItem('sidebar-expanded') === 'true';
  if (isExpanded && window.innerWidth >= 1400) {
    sidebar?.classList.add('expanded');
    toggleBtn?.setAttribute('aria-expanded', 'true');
  }

  // Toggle sidebar with animation
  toggleBtn?.addEventListener('click', () => {
    const expanded = sidebar?.classList.toggle('expanded');
    toggleBtn?.setAttribute('aria-expanded', expanded ? 'true' : 'false');
    localStorage.setItem('sidebar-expanded', expanded ? 'true' : 'false');
    
    // Add pulse animation to toggle button
    toggleBtn.style.transform = 'scale(1.2)';
    setTimeout(() => {
      toggleBtn.style.transform = '';
    }, 200);
  });

  // Highlight active page
  const currentPath = window.location.pathname;
  sidebarLinks.forEach(link => {
    const href = link.getAttribute('href');
    if (href === currentPath || (href === '/' && currentPath === '/')) {
      link.setAttribute('aria-current', 'page');
    }
  });

  // Auth-based visibility
  import { authService } from '../utils/api/index';


  function updateSidebarVisibility() {
    const authElements = sidebar?.querySelectorAll('.auth-only');
    const guestElements = sidebar?.querySelectorAll('.guest-only');
    const homeElement = document.getElementById('home-page');
    const isLoggedIn = authService.isAuthenticated();

    authElements?.forEach(el => {
      if (isLoggedIn) {
        (el as HTMLElement).style.removeProperty("display");
        homeElement.style.display = "none";
      } else {
        authElements?.forEach(el => {
          (el as HTMLElement).style.display = "none";
        });
      }
    });
    
    guestElements?.forEach(el => {
      (el as HTMLElement).style.display = isLoggedIn ? 'none' : '';
    });
  }

  // Logout functionality
  function handleLogout() {
    authService.logout();
    window.location.href = '/login';
  }

  // Initialize on load
  updateSidebarVisibility();

  // Setup logout button
  const logoutBtn = document.getElementById('sidebar-logout-btn');
  logoutBtn?.addEventListener('click', handleLogout);

  // Listen for storage changes (multi-tab sync)
  window.addEventListener('storage', updateSidebarVisibility);

  // Mobile menu toggle (triggered from Navigation component)
  window.addEventListener('toggle-mobile-sidebar', () => {
    if (window.innerWidth < 1400) {
      sidebar?.classList.toggle('mobile-open');
    }
  });

  // Close sidebar when clicking outside on mobile
  document.addEventListener('click', (e) => {
    if (window.innerWidth < 1400 && 
        sidebar?.classList.contains('mobile-open') && 
        !sidebar.contains(e.target as Node) &&
        !(e.target as HTMLElement)?.closest('#menu-toggle')) {
      sidebar?.classList.remove('mobile-open');
    }
  });
</script>
