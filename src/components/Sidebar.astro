---
// Modern collapsible sidebar with mini icons
---

<aside 
  id="sidebar" 
  class="fixed left-0 top-0 h-screen bg-black/95 backdrop-blur-md terminal-border border-l-0 border-t-0 border-b-0 z-30 transition-all duration-300 ease-in-out"
  aria-label="Main sidebar navigation"
>
  <!-- Toggle Button -->
  <button 
    id="sidebar-toggle"
    class="absolute -right-3 top-6 w-6 h-6 rounded-full bg-gradient-to-r from-cyber-600 to-matrix-600 terminal-border flex items-center justify-center hover:scale-110 transition-transform duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyber-400 "
    aria-label="Toggle sidebar"
    aria-expanded="false"
  >
    <svg class="w-3 h-3 text-black transition-transform duration-300" id="toggle-icon" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </button>

  <!-- Logo Section -->
  

  <!-- Navigation Links -->
  <nav class="flex flex-col gap-2 p-4" aria-label="Sidebar navigation">
    <!-- Home -->
    <a 
      href="/" 
      class="sidebar-link group relative flex items-center h-12 rounded-lg hover:bg-cyber-400/10 transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyber-400"
      data-label="Home"
    >
      <div class="flex items-center justify-center w-12 h-12">
        <svg class="w-6 h-6 text-cyber-400 group-hover:text-cyber-300 transition-colors" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-cyber-300 whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-300">HOME</span>
      <div class="sidebar-tooltip absolute left-full ml-2 px-3 py-2 bg-black/95 terminal-border rounded-lg text-cyber-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-200 z-50">
        Home
      </div>
    </a>

    <!-- Scan -->
    <a 
      href="/scan" 
      class="sidebar-link auth-only group relative flex items-center h-12 rounded-lg hover:bg-cyber-400/10 transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyber-400"
      data-label="Scan"
    >
      <div class="flex items-center justify-center w-12 h-12">
        <svg class="w-6 h-6 text-cyber-400 group-hover:text-cyber-300 transition-colors" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-cyber-300 whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-300">SCAN</span>
      <div class="sidebar-tooltip absolute left-full ml-2 px-3 py-2 bg-black/95 terminal-border rounded-lg text-cyber-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-200 z-50">
        Scan Project
      </div>
    </a>

    <!-- Dashboard -->
    <a 
      href="/dashboard" 
      class="sidebar-link auth-only group relative flex items-center h-12 rounded-lg hover:bg-cyber-400/10 transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyber-400"
      data-label="Dashboard"
    >
      <div class="flex items-center justify-center w-12 h-12">
        <svg class="w-6 h-6 text-cyber-400 group-hover:text-cyber-300 transition-colors" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-cyber-300 whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-300">DASHBOARD</span>
      <div class="sidebar-tooltip absolute left-full ml-2 px-3 py-2 bg-black/95 terminal-border rounded-lg text-cyber-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-200 z-50">
        Dashboard
      </div>
    </a>

    <!-- About -->
    <a 
      href="/about" 
      class="sidebar-link group relative flex items-center h-12 rounded-lg hover:bg-cyber-400/10 transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyber-400"
      data-label="About"
    >
      <div class="flex items-center justify-center w-12 h-12">
        <svg class="w-6 h-6 text-cyber-400 group-hover:text-cyber-300 transition-colors" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-cyber-300 whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-300">ABOUT</span>
      <div class="sidebar-tooltip absolute left-full ml-2 px-3 py-2 bg-black/95 terminal-border rounded-lg text-cyber-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-200 z-50">
        About
      </div>
    </a>

    <!-- Divider -->
    <div class="my-2 border-t border-cyber-400/20"></div>

    <!-- Login (guest only) -->
    <a 
      href="/login" 
      class="sidebar-link guest-only group relative flex items-center h-12 rounded-lg hover:bg-cyber-400/10 transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyber-400"
      data-label="Login"
    >
      <div class="flex items-center justify-center w-12 h-12">
        <svg class="w-6 h-6 text-cyber-400 group-hover:text-cyber-300 transition-colors" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-matrix-300 group-hover:text-cyber-300 whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-300">LOGIN</span>
      <div class="sidebar-tooltip absolute left-full ml-2 px-3 py-2 bg-black/95 terminal-border rounded-lg text-cyber-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-200 z-50">
        Login
      </div>
    </a>

    <!-- Logout (auth only) -->
    <button 
      id="sidebar-logout-btn"
      class="sidebar-link auth-only group relative flex items-center h-12 rounded-lg hover:bg-red-500/10 transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-red-400 w-full"
      data-label="Logout"
    >
      <div class="flex items-center justify-center w-12 h-12">
        <svg class="w-6 h-6 text-red-400 group-hover:text-red-300 transition-colors" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>
      </div>
      <span class="sidebar-text ml-3 text-red-300 group-hover:text-red-200 whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-300">LOGOUT</span>
      <div class="sidebar-tooltip absolute left-full ml-2 px-3 py-2 bg-black/95 terminal-border rounded-lg text-red-400 text-sm whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-200 z-50">
        Logout
      </div>
    </button>
  </nav>
</aside>

<style>
  /* Sidebar default (collapsed) state */
  #sidebar {
    width: 80px;
  }

  /* Sidebar expanded state */
  #sidebar.expanded {
    width: 140px;
  }

  #sidebar.expanded .sidebar-text {
    opacity: 1;
    pointer-events: auto;
  }

  #sidebar.expanded #toggle-icon {
    transform: rotate(180deg);
  }

  /* Tooltips only show when collapsed */
  #sidebar:not(.expanded) .sidebar-link:hover .sidebar-tooltip {
    opacity: 1;
    pointer-events: auto;
  }

  /* Hide tooltips when expanded */
  #sidebar.expanded .sidebar-tooltip {
    display: none;
  }

  /* Active link indicator */
  .sidebar-link[aria-current="page"] {
    background: linear-gradient(90deg, rgba(26, 255, 239, 0.15), transparent);
    border-left: 3px solid #1affef;
  }

  /* Mobile responsive */
  @media (max-width: 768px) {
    #sidebar {
      transform: translateX(-100%);
      width: 140px !important;
    }

    #sidebar.mobile-open {
      transform: translateX(0);
    }

    #sidebar.mobile-open .sidebar-text {
      opacity: 1;
      pointer-events: auto;
    }

    #sidebar-toggle {
      display: none;
    }
  }

  /* Adjust main content padding when sidebar is present */
  @media (min-width: 769px) {
    :global(main), :global(section), :global(.relative) {
      transition: padding-left 0.3s ease-in-out;
    }
  }
</style>

<script>
  // Sidebar toggle functionality
  const sidebar = document.getElementById('sidebar');
  const toggleBtn = document.getElementById('sidebar-toggle');
  const sidebarLinks = document.querySelectorAll('.sidebar-link');

  // Check if sidebar should be expanded from localStorage
  const isExpanded = localStorage.getItem('sidebar-expanded') === 'true';
  if (isExpanded && window.innerWidth >= 769) {
    sidebar?.classList.add('expanded');
    toggleBtn?.setAttribute('aria-expanded', 'true');
  }

  // Toggle sidebar
  toggleBtn?.addEventListener('click', () => {
    const expanded = sidebar?.classList.toggle('expanded');
    toggleBtn?.setAttribute('aria-expanded', expanded ? 'true' : 'false');
    localStorage.setItem('sidebar-expanded', expanded ? 'true' : 'false');
  });

  // Highlight active page
  const currentPath = window.location.pathname;
  sidebarLinks.forEach(link => {
    const href = link.getAttribute('href');
    if (href === currentPath || (href === '/' && currentPath === '/')) {
      link.setAttribute('aria-current', 'page');
    }
  });

  // Auth-based visibility
  import { authService } from '../utils/api/index';

  function updateSidebarVisibility() {
    const isLoggedIn = authService.isAuthenticated();
    
    const authElements = sidebar?.querySelectorAll('.auth-only');
    const guestElements = sidebar?.querySelectorAll('.guest-only');
    
    authElements?.forEach(el => {
      (el as HTMLElement).style.display = isLoggedIn ? '' : 'none';
    });
    
    guestElements?.forEach(el => {
      (el as HTMLElement).style.display = isLoggedIn ? 'none' : '';
    });
  }

  // Logout functionality
  function handleLogout() {
    authService.logout();
    window.location.href = '/login';
  }

  // Initialize on load
  updateSidebarVisibility();

  // Setup logout button
  const logoutBtn = document.getElementById('sidebar-logout-btn');
  logoutBtn?.addEventListener('click', handleLogout);

  // Listen for storage changes (multi-tab sync)
  window.addEventListener('storage', updateSidebarVisibility);

  // Mobile menu toggle (triggered from Navigation component)
  window.addEventListener('toggle-mobile-sidebar', () => {
    if (window.innerWidth < 769) {
      sidebar?.classList.toggle('mobile-open');
    }
  });

  // Close sidebar when clicking outside on mobile
  document.addEventListener('click', (e) => {
    if (window.innerWidth < 769 && 
        sidebar?.classList.contains('mobile-open') && 
        !sidebar.contains(e.target as Node) &&
        !(e.target as HTMLElement)?.closest('#menu-toggle')) {
      sidebar?.classList.remove('mobile-open');
    }
  });
</script>
